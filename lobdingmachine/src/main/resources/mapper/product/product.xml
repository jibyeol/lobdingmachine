<?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.ldcc.lobdingmachine.dao.ProductDao">
	
	<select id="getProductByCategoryIdx" 
		resultType="Product" parameterType="int">
		SELECT 
		    *
		FROM
		    ldcc.product
		<if test="value > 0">
		WHERE
		    categoryIdx = #{value};
		</if>
	</select>
	
	<select id="getProductByCategoryIdxLimit" resultType="Product">
		SELECT 
		    *
		FROM
		    ldcc.product
		<if test="categoryIdx > 0">
		WHERE
		    categoryIdx = #{categoryIdx};
		</if>
		LIMIT #{offset}, #{rows}
	</select>
	
	<insert id="setbuyProduct" parameterType="Buy">
		insert INTO ldcc.payment
		(memberIdx, productIdx, payDate, machineIdx)
		values
	<foreach collection="productList" item="product"
      open="(" separator="," close=")">
        (#{member.idx}, #{product.idx}, now(), 1);
  	</foreach>
	</insert>
	
	<select id="getTotalCount" parameterType="int" resultType="int">
		SELECT 
		    COUNT(*)
		FROM
		    ldcc.product
		<if test="value > 0">
		WHERE
		    categoryIdx = #{value};
		</if>
	</select>
	
	<insert id="insert" parameterType="Product">
		INSERT INTO
			ldcc.product (`company`, `name`, `categoryIdx`, `price`, `imgUrl`, `description`)
		VALUES
			(#{company}, #{name}, #{categoryIdx}, #{price}, #{imgUrl}, #{description})
	</insert>
	
	<update id="update" parameterType="Product">
		UPDATE 
		`ldcc`.`product` 
		SET 
			`name` = #{name},
			`company` = #{company}, 
			`categoryIdx` = #{categoryIdx}, 
			`price` = #{price}, 
			`imgUrl` = #{imgUrl}, 
			`description` = #{description} 
		WHERE `idx` = #{idx};
	</update>
	
	<delete id="delete" parameterType="int">
		DELETE FROM `ldcc`.`product`
		WHERE idx = #{value};
	</delete>
	
	<select id="getDetail" parameterType="int" resultType="Product">
		SELECT 
		    p.*, i.sampleCount AS sample, i.repositoryCount AS count
		FROM
		    ldcc.machine_inventory i
		        LEFT JOIN
		    ldcc.product p ON p.idx = i.productIdx
		WHERE
		    i.machineIdx = 1 AND p.idx = #{value};
	</select>
	
</mapper>
