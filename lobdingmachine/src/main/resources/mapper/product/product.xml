<?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.ldcc.lobdingmachine.dao.ProductDao">
	
	<select id="getProductByCategoryIdx" 
		resultType="Product" parameterType="int">
		SELECT 
		    *
		FROM
		    ldcc.product
		<if test="value > 0">
		WHERE
		    category_idx = #{value};
		</if>
	</select>
	
	<insert id="setbuyProduct" parameterType="String">
		insert INTO ldcc.payment
		(member_idx, product_idx, pay_date, machine_idx)
		values
	<foreach collection="productList" item="buy"
      open="(" separator="," close=")">
        (1, #{buy.idx}, now(), 1);
  	</foreach>
	</insert>
	
	<select id="getTotalCount" parameterType="int" resultType="int">
		SELECT 
		    COUNT(*)
		FROM
		    ldcc.product
		<if test="value > 0">
		WHERE
		    category_idx = #{value};
		</if>
	</select>
	
	<insert id="insert" parameterType="Product">
		INSERT INTO
			ldcc.product (`name`, `categoryIdx`, `price`, `imgUrl`, `description`)
		VALUES
			(#{name}, #{categoryIdx}, #{price}, #{imgUrl}, #{description})
	</insert>
	
	<select id="getDetail" parameterType="int" resultType="Product">
		SELECT 
		    p.*, i.sampleCount AS sample, i.repositoryCount AS count
		FROM
		    ldcc.machine_inventory i
		        LEFT JOIN
		    ldcc.product p ON p.idx = i.productIdx
		WHERE
		    i.machineIdx = 1 AND p.idx = #{value};
	</select>
	
</mapper>
